---
title: "Benchmarking {SpeedyMarkov}"
author: "Sam Abbott"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Benchmarking {SpeedyMarkov}}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, comment = "#>",
  fig.width = 7, fig.height = 7, 
  fig.align = "center"
)
```

## Benchmarking setup

The `SpeedyMarkov` and reference implementations have been benchmarked with a range of optimisations including making use of `Rcpp` and parallisation. Several parallisation approaches have been explored as has the use of a varying number of cores. The benchmarking grid has been implemented within `SpeedyMarkov` - see below for details.

* Load required packages.

```{r}
library(SpeedyMarkov)
library(microbenchmark)
library(parallel)
library(furrr)
library(ggplot2)
```

* Code for the benchmarking grid.

```{r}
SpeedyMarkov::benchmark_markov
```

All benchmarking results have been run elsewhere (`inst/scripts/benchmarking`) and then saved (`inst/benchmarks`). These benchmarks can be recreated locally by running the following in the package directory (*Warning:: This is likely to take upwards of an hour and a half*)

```{bash, eval = FALSE}
Rscript inst/scripts/benchmarking.R
```

## Two state Markov model

The two state Markov model has been benchmarked for both 100 cycles and 200 cycles (duration) with 100,000 samples each time - repeated 10 times per benchmark.

### Duration: 100

* Table

```{r}
two_state_bench_dur_100 <- readRDS("../inst/benchmarks/two_state_duration_100.rds") 

two_state_bench_dur_100
```

* Plot

```{r, width = 16, height = 12}
ggplot2::autoplot(two_state_bench_dur_100) +
  theme_minimal()
```

### Duration: 200

* Table

```{r}
two_state_bench_dur_200 <- readRDS("../inst/benchmarks/two_state_duration_200.rds")

two_state_bench_dur_200
```


* Plot

```{r, width = 16, height = 12}
ggplot2::autoplot(two_state_bench_dur_200) +
  theme_minimal()
```
